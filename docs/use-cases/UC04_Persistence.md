# UC04: 데이터 영속성 유지 (Data Persistence)

## 1. 개요

사용자가 브라우저를 닫거나 새로고침하더라도 기록된 습관 데이터와 체크 내역이 유지되는 과정입니다.

## 2. 관련 요구 사항

- PRD 5 (기술적 요구 사항)
- TRD 5 (데이터 영속성 계층)

## 3. 액터 (Actor)

- 시스템 (System)

## 4. 기본 흐름 (Success Scenario)

### 4.1 데이터 자동 저장

1. 사용자가 습관을 추가하거나 데일리 체크를 수행하는 등 상태 변경 이벤트를 발생시킵니다.
2. Zustand의 `persist` 미들웨어가 상태 변경을 감지합니다.
3. 시스템은 변경된 전체 상태를 JSON 직렬화하여 브라우저의 `localStorage`의 `routine-checker-storage` 키에 즉시 저장합니다.

### 4.2 데이터 복구 (애플리케이션 로드)

1. 사용자가 웹 애플리케이션에 다시 접속하거나 페이지를 새로고침합니다.
2. 시스템이 초기화될 때 LocalStorage에 저장된 데이터가 있는지 확인합니다.
3. 유효한 데이터가 존재할 경우, 시스템은 해당 데이터를 역직렬화하여 Zustand 스토어의 초기 상태로 주입합니다.
4. 사용자는 이전에 체크했던 기록과 습관 목록이 그대로 유지된 화면을 보게 됩니다.

## 5. 예외 흐름 (Exception Scenario)

- **저장 공간 부족 (QuotaExceededError)**: 브라우저의 LocalStorage 용량 제한을 초과할 경우, 시스템은 콘솔에 경고를 남기고 사용자에게 데이터 저장에 실패했음을 알리는 간단한 토스트 메시지를 표시할 수 있습니다. (향후 고도화 시 고려)
- **데이터 오류/손상**: LocalStorage 데이터가 손상되어 파싱에 실패할 경우, 시스템은 기본값(빈 목록)으로 초기화하며 안정적인 동작을 유지합니다.
